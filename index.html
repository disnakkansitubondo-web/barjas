<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI BARJAS - SISTEM BANTUAN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #00695c;
            --accent-color: #ff8f00;
            --light-blue: #e3f2fd;
            --dark-blue: #082e5c;
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--dark-blue));
            --gradient-secondary: linear-gradient(135deg, var(--secondary-color), #004d40);
            --gradient-accent: linear-gradient(135deg, var(--accent-color), #e65100);
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 28px rgba(0,0,0,0.15);
            --login-gradient: linear-gradient(135deg, #0d47a1, #00695c, #ff8f00);
        }
        
        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #e8f5e9 100%);
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            min-height: 100vh;
            padding: 10px 0;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-lg);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .app-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .app-logo {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }
        
        .app-subtitle {
            font-size: 1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 300;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin-bottom: 8px;
            padding: 12px 15px;
            font-weight: 500;
            color: #444;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .nav-pills .nav-link:hover {
            background-color: #f0f7ff;
            transform: translateX(3px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
            color: white;
        }
        
        .section-title {
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 20px 0;
            font-weight: 700;
            color: var(--dark-blue);
            font-size: 1.4rem;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 12px;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-success {
            background: var(--gradient-secondary);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-warning {
            background: var(--gradient-accent);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .form-label {
            font-weight: 600;
            color: #444;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .form-label i {
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
            transform: translateY(-2px);
        }
        
        .copyright {
            text-align: center;
            padding: 20px;
            background-color: var(--light-blue);
            color: var(--dark-blue);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .data-table {
            font-size: 0.85rem;
            border-collapse: separate;
            border-spacing: 0;
            box-shadow: var(--shadow-sm);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            position: relative;
            font-size: 0.85rem;
        }
        
        .data-table th::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.3);
        }
        
        .data-table td {
            padding: 10px 8px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fbff;
        }
        
        .data-table tr:hover {
            background-color: #edf5ff;
        }
        
        .feature-icon {
            font-size: 1.1rem;
            margin-right: 8px;
            width: 24px;
            text-align: center;
        }
        
        .card {
            border-radius: 10px;
            border: none;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            font-size: 0.95rem;
        }
        
        .stats-box {
            text-align: center;
            padding: 20px 15px;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stats-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        .stats-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .stats-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 280px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            max-width: calc(100vw - 40px);
        }
        
        .input-error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            color: white;
            font-weight: 300;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--light-blue);
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .badge-custom {
            background: var(--gradient-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1050;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 8px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
        
        /* Responsive styles */
        @media (max-width: 991.98px) {
            .col-md-3.col-lg-2 {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 1050;
                width: 280px;
                transition: left 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .col-md-3.col-lg-2.mobile-show {
                left: 0;
            }
            
            .col-md-9.col-lg-10 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar-overlay.mobile-show {
                display: block;
            }
        }
        
        /* Print Styles - IMPROVED FOR LANDSCAPE */
        @media print {
            @page {
                size: landscape;
                margin: 0.5cm;
            }
            
            body * {
                visibility: hidden;
            }
            
            .app-container, .app-container * {
                visibility: visible;
            }
            
            .app-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .nav-pills, .mobile-menu-btn, .sidebar-overlay, .floating-action-btn,
            .btn-group, .filter-section, .toast {
                display: none !important;
            }
            
            .col-md-3.col-lg-2.p-4.bg-light {
                display: none !important;
            }
            
            .col-md-9.col-lg-10.p-5 {
                width: 100%;
                flex: 0 0 100%;
                max-width: 100%;
                padding: 0 !important;
            }
            
            .copyright {
                display: none;
            }
            
            .data-table {
                font-size: 10px;
                width: 100% !important;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
            }
            
            /* Sembunyikan kolom aksi dan link Google Drive saat mencetak */
            .data-table th:last-child,
            .data-table td:last-child {
                display: none !important;
            }
            
            /* Judul untuk laporan cetak */
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .print-title {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .print-date {
                font-size: 12px;
                text-align: right;
                margin-bottom: 10px;
            }
        }

        /* WhatsApp link style */
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
        }
        
        .whatsapp-link:hover {
            text-decoration: underline;
        }
        
        /* View Link Button */
        .btn-view {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            color: white;
        }
        
        /* Undo Button */
        .btn-undo {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
        }
        
        .btn-undo:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }
        
        /* WhatsApp number link in table */
        .whatsapp-number {
            color: #25D366;
            cursor: pointer;
            text-decoration: underline;
        }
        
        /* Welcome Modal Styles */
        .welcome-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .welcome-header {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: 25px;
        }
        
        .welcome-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .welcome-body {
            padding: 25px;
            text-align: center;
        }
        
        .welcome-footer {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .countdown-timer {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Button untuk cetak per data */
        .btn-print-individual {
            background: linear-gradient(135deg, #6f42c1, #5a2d95);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .btn-print-individual:hover {
            background: linear-gradient(135deg, #5a2d95, #4a2479);
            color: white;
        }
        
        /* Developer Info Styles */
        .developer-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-info h6 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .developer-contact p {
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .developer-contact a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .developer-contact a:hover {
            color: var(--dark-blue);
            text-decoration: underline;
        }
        
        /* Loading spinner */
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Login Modal Styles */
        .login-modal .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .login-header {
            background: var(--login-gradient);
            color: white;
            text-align: center;
            padding: 25px 20px;
            position: relative;
        }

        .login-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: white;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 5px 0 0;
        }

        .login-body {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-label {
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .login-form-label i {
            margin-right: 10px;
            color: var(--dark-blue);
        }

        .login-form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }

        .login-form-control:focus {
            border-color: var(--dark-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.2);
        }

        .login-input-group-text {
            background: var(--light-blue);
            border: 2px solid #ddd;
            border-left: none;
        }

        .btn-login {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            border-radius: 8px;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.4);
        }

        .btn-login:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-security-notice {
            text-align: center;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #666;
        }

        .login-attempts-count {
            text-align: center;
            font-size: 0.9rem;
            color: #ff8f00;
            font-weight: 500;
            margin-top: 5px;
        }

        .login-blocked-message {
            text-align: center;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #dc3545;
            font-weight: 500;
        }

        .login-countdown {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .login-developer-info {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        .login-developer-logo {
            max-width: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .login-developer-contact a {
            color: var(--dark-blue);
            text-decoration: none;
            transition: all 0.3s;
            display: inline-block;
            margin: 5px 0;
        }

        .login-developer-contact a:hover {
            color: var(--primary-color);
            text-decoration: underline;
            transform: translateY(-2px);
        }

        .login-copyright {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Animations */
        @keyframes login-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .login-shake {
            animation: login-shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Login particle background */
        #login-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1040; /* Higher than modal backdrop */
            display: none;
        }

        /* Link Google Drive dalam tabel */
        .drive-link {
            color: #0d47a1;
            text-decoration: none;
            cursor: pointer;
        }

        .drive-link:hover {
            text-decoration: underline;
        }

        /* Modal untuk menambah link */
        .link-modal .modal-dialog {
            max-width: 600px;
        }
        
        /* App content when not authenticated */
        .app-content-unauthenticated {
            display: none;
        }

        /* Search box for desa dropdown */
        .dropdown-search-container {
            position: relative;
        }

        .dropdown-search {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            display: none;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Kode Validasi Styles */
        .kode-validasi-container {
            display: flex;
            align-items: center;
        }
        
        .kode-validasi-input {
            flex: 1;
            margin-right: 10px;
        }
        
        .btn-generate-kode {
            white-space: nowrap;
        }

        /* Auto-fill button styles */
        .btn-auto-fill {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-auto-fill:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .login-hint {
            font-size: 0.85rem;
            color: #0d6efd;
            margin-top: 5px;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #0d6efd;
        }

        /* New styles for additional fields */
        .btn-not-group {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        
        .btn-not-group:hover {
            background: linear-gradient(135deg, #5a6268, #4e555b);
            color: white;
        }

        .jenis-bantuan-container {
            display: flex;
            gap: 10px;
        }

        .jenis-bantuan-container select,
        .jenis-bantuan-container input {
            flex: 1;
        }

        /* WhatsApp input styling */
        .whatsapp-input-container {
            position: relative;
        }

        .whatsapp-prefix {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #25D366;
            font-weight: bold;
        }

        .whatsapp-input {
            padding-left: 30px;
        }

        /* Preview modal styles */
        .preview-container {
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .preview-table th, 
        .preview-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .preview-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .preview-table tr:nth-child(even) {
            background-color: #f8f8f8;
        }

        .preview-table tr:hover {
            background-color: #eaeaea;
        }
    </style>
</head>
<body>
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="login-header">
                    <div class="login-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h2 class="login-title">AUTHENTICATION REQUIRED</h2>
                    <p class="login-subtitle">Masukkan Kode Keamanan untuk Mengakses Aplikasi</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3 login-form-group">
                            <label class="form-label login-form-label">
                                <i class="fas fa-key"></i> Kode Keamanan
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control login-form-control" id="securityCode" placeholder="Masukkan kode akses aplikasi">
                                <button class="btn btn-outline-secondary toggle-password" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text text-danger login-attempts-count" id="attemptsCount"></div>
                            <div class="login-hint">
                                <i class="fas fa-lightbulb"></i> PEMERINTAH KABUPATEN SITUBONDO
                            </div>
                        </div>
                        <button type="submit" class="btn btn-login" id="loginButton">
                            <span class="login-button-text">Masuk ke Aplikasi</span>
                            <span class="spinner-border spinner-border-sm d-none" id="loginSpinner"></span>
                        </button>
                    </form>
                    
                    <div class="login-blocked-message d-none" id="blockedMessage">
                        <i class="fas fa-ban me-2"></i>
                        <span id="blockedText">Terlalu banyak percobaan gagal. Silakan coba lagi dalam </span>
                        <span class="login-countdown" id="countdown">30</span> detik.
                    </div>
                    
                    <div class="login-security-notice">
                        <i class="fas fa-info-circle me-2"></i>
                        Hubungi Administrator untuk mendapatkan kode akses
                    </div>
                    
                    <div class="login-developer-info">
                        <h5 class="mb-3">Developer Information</h5>
                        <div class="login-developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                    
                    <div class="login-copyright">
                        &copy; 2025 Lentera karya Situbondo
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="login-particles"></div>
    
    <div class="app-content-unauthenticated" id="appContent">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <div class="app-container animate-fadeIn">
            <div class="app-header">
                <div class="app-logo">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <h1 class="app-title">BARJAS</h1>
                <p class="app-subtitle">Sistem Bantuan Terpadu</p>
                <p class="app-subtitle">DINAS PETERNAKAN DAN PERIKANAN KABUPATEN SITUBONDO</p>
                <div class="watermark">WebApp v9.8.96 CopyRight Lentera Karya Situbondo</div>
            </div>
            
            <div class="row g-0">
                <div class="col-md-3 col-lg-2 p-4 bg-light" id="sidebarMenu">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link active" id="v-pills-dashboard-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dashboard" type="button" role="tab" aria-controls="v-pills-dashboard" aria-selected="true">
                            <i class="fas fa-tachometer-alt feature-icon"></i> Dashboard
                        </button>
                        <button class="nav-link" id="v-pills-input-tab" data-bs-toggle="pill" data-bs-target="#v-pills-input" type="button" role="tab" aria-controls="v-pills-input" aria-selected="false">
                            <i class="fas fa-pencil-alt feature-icon"></i> Input Data
                        </button>
                        <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab" aria-controls="v-pills-data" aria-selected="false">
                            <i class="fas fa-database feature-icon"></i> Data Bantuan
                        </button>
                        <button class="nav-link" id="v-pills-filter-tab" data-bs-toggle="pill" data-bs-target="#v-pills-filter" type="button" role="tab" aria-controls="v-pills-filter" aria-selected="false">
                            <i class="fas fa-filter feature-icon"></i> Filter Data
                        </button>
                        <button class="nav-link" id="v-pills-print-tab" data-bs-toggle="pill" data-bs-target="#v-pills-print" type="button" role="tab" aria-controls="v-pills-print" aria-selected="false">
                            <i class="fas fa-print feature-icon"></i> Cetak Laporan
                        </button>
                        <button class="nav-link" id="v-pills-export-tab" data-bs-toggle="pill" data-bs-target="#v-pills-export" type="button" role="tab" aria-controls="v-pills-export" aria-selected="false">
                            <i class="fas fa-file-export feature-icon"></i> Ekspor Data
                        </button>
                        <button class="nav-link" id="v-pills-backup-tab" data-bs-toggle="pill" data-bs-target="#v-pills-backup" type="button" role="tab" aria-controls="v-pills-backup" aria-selected="false">
                            <i class="fas fa-download feature-icon"></i> Backup & Restore
                        </button>
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">
                            <i class="fas fa-cog feature-icon"></i> Pengaturan
                        </button>
                        <button class="nav-link" id="v-pills-logout-tab" type="button">
                            <i class="fas fa-sign-out-alt feature-icon"></i> Keluar
                        </button>
                    </div>
                    
                    <div class="developer-info mt-4">
                        <h6>Developer Contact</h6>
                        <div class="developer-contact">
                            <p><i class="fab fa-whatsapp me-2"></i> <a href="https://wa.me/6285647709114" target="_blank">+62 856-4770-9114</a></p>
                            <p><i class="fas fa-envelope me-2"></i> <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a></p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-9 col-lg-10 p-5">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-dashboard" role="tabpanel" aria-labelledby="v-pills-dashboard-tab">
                            <h3 class="section-title">Dashboard</h3>
                            
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-users fa-2x text-primary"></i>
                                        <div class="stats-number" id="totalPenerima">0</div>
                                        <div class="stats-label">Total Penerima</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-money-bill-wave fa-2x text-success"></i>
                                        <div class="stats-number" id="totalBantuan">0</div>
                                        <div class="stats-label">Total Bantuan</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-calendar-alt fa-2x text-warning"></i>
                                        <div class="stats-number" id="tahunAktif">2025</div>
                                        <div class="stats-label">Tahun Aktif</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stats-box">
                                        <i class="fas fa-chart-line fa-2x text-info"></i>
                                        <div class="stats-number" id="rataBantuan">0</div>
                                        <div class="stats-label">Rata-rata Bantuan</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-pie me-2"></i> Distribusi Bantuan per Kecamatan
                                        </div>
                                        <div class="card-body">
                                            <canvas id="kecamatanChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-chart-bar me-2"></i> Tren Bantuan per Tahun
                                        </div>
                                        <div class="card-body">
                                            <canvas id="tahunChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-history me-2"></i> Data Terbaru
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover data-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Tanggal</th>
                                                            <th>Nama Penerima</th>
                                                            <th>Desa</th>
                                                            <th>Jenis Bantuan</th>
                                                            <th>Jumlah</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recentData">
                                                        <tr>
                                                            <td colspan="5" class="text-center">Tidak ada data</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-input" role="tabpanel" aria-labelledby="v-pills-input-tab">
                            <h3 class="section-title">Input Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-pencil-alt me-2"></i> Formulir Input Data
                                </div>
                                <div class="card-body">
                                    <form id="inputForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="nama" class="form-label">
                                                    <i class="fas fa-user"></i> Nama Penerima
                                                </label>
                                                <input type="text" class="form-control" id="nama" required>
                                                <div class="error-message" id="namaError"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="nik" class="form-label">
                                                    <i class="fas fa-id-card"></i> NIK
                                                </label>
                                                <input type="text" class="form-control" id="nik" required>
                                                <div class="error-message" id="nikError"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="whatsapp" class="form-label">
                                                    <i class="fab fa-whatsapp"></i> Nomor WhatsApp
                                                </label>
                                                <div class="whatsapp-input-container">
                                                    <span class="whatsapp-prefix">+62</span>
                                                    <input type="text" class="form-control whatsapp-input" id="whatsapp" placeholder="8xx-xxxx-xxxx" required>
                                                </div>
                                                <div class="error-message" id="whatsappError"></div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaKelompok" class="form-label">
                                                    <i class="fas fa-users"></i> Nama Kelompok
                                                </label>
                                                <div class="d-flex">
                                                    <input type="text" class="form-control" id="namaKelompok">
                                                    <button type="button" class="btn btn-not-group ms-2" id="btnBukanKelompok">
                                                        Bukan Kelompok
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="jabatan" class="form-label">
                                                    <i class="fas fa-user-tag"></i> Jabatan
                                                </label>
                                                <select class="form-select" id="jabatan">
                                                    <option value="Ketua Kelompok">Ketua Kelompok</option>
                                                    <option value="Sekretaris">Sekretaris</option>
                                                    <option value="Bendahara">Bendahara</option>
                                                    <option value="Pengawas">Pengawas</option>
                                                    <option value="Anggota">Anggota</option>
                                                    <option value="Individu" selected>Individu</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="tahunAnggaran" class="form-label">
                                                    <i class="fas fa-calendar"></i> Tahun Anggaran
                                                </label>
                                                <select class="form-select" id="tahunAnggaran">
                                                    </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="kecamatan" class="form-label">
                                                    <i class="fas fa-map-marker-alt"></i> Kecamatan
                                                </label>
                                                <select class="form-select" id="kecamatan">
                                                    <option value="">Pilih Kecamatan</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="desa" class="form-label">
                                                    <i class="fas fa-map-marked-alt"></i> Desa
                                                </label>
                                                <select class="form-select" id="desa">
                                                    <option value="">Pilih Desa</option>
                                                    </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="alamat" class="form-label">
                                                    <i class="fas fa-home"></i> Alamat Lengkap
                                                </label>
                                                <textarea class="form-control" id="alamat" rows="1"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jenisBantuan" class="form-label">
                                                    <i class="fas fa-gift"></i> Jenis Bantuan
                                                </label>
                                                <select class="form-select" id="jenisBantuan">
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="namaBantuan" class="form-label">
                                                    <i class="fas fa-gift"></i> Nama Bantuan
                                                </label>
                                                <input type="text" class="form-control" id="namaBantuan" placeholder="Contoh: Mesin, Uang Tunai BOS, Perbaikan Rumah">
                                                <div class="form-text">Masukkan nama spesifik bantuan yang diberikan</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="jumlahBantuan" class="form-label">
                                                    <i class="fas fa-coins"></i> Jumlah Bantuan
                                                </label>
                                                <div class="jenis-bantuan-container">
                                                    <input type="text" class="form-control" id="jumlahBantuan" placeholder="Jumlah">
                                                    <select class="form-select" id="satuanBantuan">
                                                        <option value="Rupiah">Rupiah</option>
                                                        <option value="Unit">Unit</option>
                                                        <option value="Paket">Paket</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="tanggalTerima" class="form-label">
                                                    <i class="fas fa-calendar-check"></i> Tanggal Menerima
                                                </label>
                                                <input type="date" class="form-control" id="tanggalTerima">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="namaPetugas" class="form-label">
                                                    <i class="fas fa-user-tie"></i> Nama Petugas
                                                </label>
                                                <input type="text" class="form-control" id="namaPetugas" placeholder="Nama petugas yang menangani">
                                                <div class="error-message" id="namaPetugasError"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="driveLink" class="form-label">
                                                    <i class="fab fa-google-drive"></i> Link Google Drive
                                                </label>
                                                <input type="url" class="form-control" id="driveLink" placeholder="https://drive.google.com/...">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="kodeValidasi" class="form-label">
                                                    <i class="fas fa-qrcode"></i> Kode Validasi
                                                </label>
                                                <div class="kode-validasi-container">
                                                    <input type="text" class="form-control kode-validasi-input" id="kodeValidasi" placeholder="Kode validasi otomatis" readonly>
                                                    <button type="button" class="btn btn-primary btn-generate-kode" id="generateKodeBtn">
                                                        Generate Kode
                                                    </button>
                                                </div>
                                                <div class="form-text">Kode unik untuk validasi data</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-12">
                                                <label for="keterangan" class="form-label">
                                                    <i class="fas fa-sticky-note"></i> Keterangan
                                                </label>
                                                <textarea class="form-control" id="keterangan" rows="2" placeholder="Tambahkan keterangan jika diperlukan"></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end mt-4">
                                            <button type="reset" class="btn btn-secondary me-2">
                                                <i class="fas fa-undo me-1"></i> Reset
                                            </button>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Simpan Data
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-data" role="tabpanel" aria-labelledby="v-pills-data-tab">
                            <h3 class="section-title">Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-database me-2"></i> Daftar Penerima Bantuan
                                    </div>
                                    <div class="d-flex">
                                        <input type="text" class="form-control form-control-sm me-2" id="searchData" placeholder="Cari data...">
                                        <button class="btn btn-sm btn-outline-secondary" id="clearSearchBtn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="dataTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Nama Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Drive Link</th>
                                                    <th>Kode Validasi</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dataTableBody">
                                                <tr>
                                                    <td colspan="17" class="text-center py-4">Tidak ada data</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div class="text-muted" id="tableInfo">
                                            Menampilkan 0 dari 0 data
                                        </div>
                                        <nav>
                                            <ul class="pagination pagination-sm mb-0" id="pagination">
                                                </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-filter" role="tabpanel" aria-labelledby="v-pills-filter-tab">
                            <h3 class="section-title">Filter Data Bantuan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-filter me-2"></i> Filter Data
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-3">
                                            <label for="filterTahun" class="form-label">Tahun</label>
                                            <select class="form-select" id="filterTahun">
                                                <option value="">Semua Tahun</option>
                                                </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterKecamatan" class="form-label">Kecamatan</label>
                                            <select class="form-select" id="filterKecamatan">
                                                <option value="">Semua Kecamatan</option>
                                                </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterDesa" class="form-label">Desa</label>
                                            <select class="form-select" id="filterDesa">
                                                <option value="">Semua Desa</option>
                                                </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label for="filterJenis" class="form-label">Jenis Bantuan</label>
                                            <select class="form-select" id="filterJenis">
                                                <option value="">Semua Jenis</option>
                                                <option value="Uang">Uang</option>
                                                <option value="Barang">Barang</option>
                                                <option value="Jasa">Jasa</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="resetFilterBtn">
                                            <i class="fas fa-undo me-1"></i> Reset Filter
                                        </button>
                                        <button type="button" class="btn btn-primary" id="applyFilterBtn">
                                            <i class="fas fa-check me-1"></i> Terapkan Filter
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="fas fa-list me-2"></i> Data Hasil Filter
                                    </div>
                                    <div class="badge bg-primary" id="filterResultCount">0 Data</div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover data-table" id="filterTable">
                                            <thead>
                                                <tr>
                                                    <th>No</th>
                                                    <th>Nama</th>
                                                    <th>NIK</th>
                                                    <th>WhatsApp</th>
                                                    <th>Kelompok</th>
                                                    <th>Jabatan</th>
                                                    <th>Tahun</th>
                                                    <th>Kecamatan</th>
                                                    <th>Desa</th>
                                                    <th>Jenis Bantuan</th>
                                                    <th>Nama Bantuan</th>
                                                    <th>Jumlah</th>
                                                    <th>Tanggal</th>
                                                    <th>Petugas</th>
                                                    <th>Drive Link</th>
                                                    <th>Kode Validasi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filterTableBody">
                                                <tr>
                                                    <td colspan="16" class="text-center py-4">Tidak ada data</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-print" role="tabpanel" aria-labelledby="v-pills-print-tab">
                            <h3 class="section-title">Cetak Laporan</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-print me-2"></i> Opsi Cetak Laporan
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-4">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                    <h5>Cetak ke PDF</h5>
                                                    <p class="text-muted">Cetak laporan dalam format PDF</p>
                                                    <button class="btn btn-danger mt-2" id="printPdfBtn">
                                                        <i class="fas fa-file-pdf me-1"></i> Cetak PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-eye fa-3x text-info mb-3"></i>
                                                    <h5>Pratinjau</h5>
                                                    <p class="text-muted">Pratinjau laporan sebelum dicetak</p>
                                                    <button class="btn btn-info mt-2" id="previewBtn">
                                                        <i class="fas fa-eye me-1"></i> Pratinjau
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Pengaturan Laporan</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="printTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="printTahun">
                                                    <option value="">Semua Tahun</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="printKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printJenis" class="form-label">Jenis Bantuan</label>
                                                <select class="form-select" id="printJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="printFormat" class="form-label">Format Laporan</label>
                                                <select class="form-select" id="printFormat">
                                                    <option value="detail">Detail Lengkap</option>
                                                    <option value="ringkas">Ringkas</option>
                                                    <option value="hanya-nama">Hanya Nama & Jumlah</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-export" role="tabpanel" aria-labelledby="v-pills-export-tab">
                            <h3 class="section-title">Ekspor Data</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-file-export me-2"></i> Opsi Ekspor Data
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-excel fa-3x text-success mb-3"></i>
                                                    <h5>Excel</h5>
                                                    <p class="text-muted">Ekspor data ke format Excel</p>
                                                    <button class="btn btn-success mt-2" id="exportExcelBtn">
                                                        <i class="fas fa-file-excel me-1"></i> Ekspor Excel
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-csv fa-3x text-info mb-3"></i>
                                                    <h5>CSV</h5>
                                                    <p class="text-muted">Ekspor data ke format CSV</p>
                                                    <button class="btn btn-info mt-2" id="exportCsvBtn">
                                                        <i class="fas fa-file-csv me-1"></i> Ekspor CSV
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-code fa-3x text-warning mb-3"></i>
                                                    <h5>JSON</h5>
                                                    <p class="text-muted">Ekspor data ke format JSON</p>
                                                    <button class="btn btn-warning mt-2" id="exportJsonBtn">
                                                        <i class="fas fa-file-code me-1"></i> Ekspor JSON
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-pdf fa-3x text-danger mb-3"></i>
                                                    <h5>PDF</h5>
                                                    <p class="text-muted">Ekspor data ke format PDF</p>
                                                    <button class="btn btn-danger mt-2" id="exportPdfBtn">
                                                        <i class="fas fa-file-pdf me-1"></i> Ekspor PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-panel">
                                        <h6 class="control-title">Pengaturan Ekspor</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="exportTahun" class="form-label">Tahun</label>
                                                <select class="form-select" id="exportTahun">
                                                    <option value="">Semua Tahun</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportKecamatan" class="form-label">Kecamatan</label>
                                                <select class="form-select" id="exportKecamatan">
                                                    <option value="">Semua Kecamatan</option>
                                                    </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportJenis" class="form-label">Jenis Bantuan</label>
                                                <select class="form-select" id="exportJenis">
                                                    <option value="">Semua Jenis</option>
                                                    <option value="Uang">Uang</option>
                                                    <option value="Barang">Barang</option>
                                                    <option value="Jasa">Jasa</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="exportFormat" class="form-label">Format Data</label>
                                                <select class="form-select" id="exportFormat">
                                                    <option value="full">Lengkap</option>
                                                    <option value="essential">Penting Saja</option>
                                                    <option value="minimal">Minimal</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-backup" role="tabpanel" aria-labelledby="v-pills-backup-tab">
                            <h3 class="section-title">Backup & Restore Data</h3>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-download me-2"></i> Backup Data
                                        </div>
                                        <div class="card-body text-center">
                                            <i class="fas fa-database fa-4x text-primary mb-3"></i>
                                            <h5>Backup Seluruh Data</h5>
                                            <p class="text-muted">Simpan salinan data ke file JSON (terenkripsi)</p>
                                            <button class="btn btn-primary mt-3" id="backupDataBtn">
                                                <i class="fas fa-download me-1"></i> Backup Data
                                            </button>
                                            <div class="mt-4">
                                                <label for="backupFileName" class="form-label">Nama File Backup</label>
                                                <input type="text" class="form-control" id="backupFileName" value="backup-barjas-secure">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <i class="fas fa-upload me-2"></i> Restore Data
                                        </div>
                                        <div class="card-body text-center">
                                            <i class="fas fa-file-upload fa-4x text-success mb-3"></i>
                                            <h5>Restore Data dari File</h5>
                                            <p class="text-muted">Muat ulang data dari file backup</p>
                                            <div class="mt-3">
                                                <input type="file" class="form-control" id="restoreFileInput" accept=".json">
                                                <button class="btn btn-success mt-3 w-100" id="restoreDataBtn" disabled>
                                                    <i class="fas fa-upload me-1"></i> Restore Data
                                                </button>
                                            </div>
                                            <div class="alert alert-warning mt-3">
                                                <i class="fas fa-exclamation-triangle me-1"></i>
                                                <strong>Peringatan:</strong> Restore akan menimpa data yang ada!
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <i class="fas fa-trash-alt me-2"></i> Reset Data
                                </div>
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle fa-4x text-danger mb-3"></i>
                                    <h5>Reset Seluruh Data</h5>
                                    <p class="text-muted">Hapus semua data dan kembali ke keadaan awal</p>
                                    <button class="btn btn-danger mt-2" id="resetDataBtn" data-bs-toggle="modal" data-bs-target="#confirmResetModal">
                                        <i class="fas fa-trash-alt me-1"></i> Reset Data
                                    </button>
                                    <div class="alert alert-danger mt-3">
                                        <i class="fas fa-radiation me-1"></i>
                                        <strong>PERINGATAN TINGGI:</strong> Tindakan ini tidak dapat dibatalkan! Semua data akan dihapus permanen.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                            <h3 class="section-title">Pengaturan Aplikasi</h3>
                            
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-cog me-2"></i> Pengaturan Umum
                                </div>
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="appName" class="form-label">Nama Aplikasi</label>
                                                <input type="text" class="form-control" id="appName" value="BARJAS">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="appSubtitle" class="form-label">Subjudul Aplikasi</label>
                                                <input type="text" class="form-control" id="appSubtitle" value="Sistem Bantuan Terpadu">
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="defaultTahun" class="form-label">Tahun Default</label>
                                                <select class="form-select" id="defaultTahun">
                                                    </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="itemsPerPage" class="form-label">Item per Halaman</label>
                                                <select class="form-select" id="itemsPerPage">
                                                    <option value="10">10 Item</option>
                                                    <option value="25">25 Item</option>
                                                    <option value="50">50 Item</option>
                                                    <option value="100">100 Item</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="backupInterval" class="form-label">Interval Backup Otomatis</label>
                                                <select class="form-select" id="backupInterval" disabled>
                                                    <option value="0">Tidak Ada</option>
                                                    <option value="1">Setiap Hari</option>
                                                    <option value="7">Setiap Minggu</option>
                                                    <option value="30">Setiap Bulan</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="settingSecurityCode" class="form-label">Kode Keamanan</label>
                                                <input type="password" class="form-control" id="settingSecurityCode">
                                                <div class="form-text">Ganti kode untuk mengakses aplikasi (biarkan kosong jika tidak ingin mengubah)</div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="autoSave" checked disabled>
                                            <label class="form-check-label" for="autoSave">Simpan Otomatis</label>
                                        </div>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="notifications" checked>
                                            <label class="form-check-label" for="notifications">Aktifkan Notifikasi</label>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end">
                                            <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <i class="fas fa-info-circle me-2"></i> Informasi Aplikasi
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Versi Aplikasi
                                                    <span class="badge bg-primary">2.1.0</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Jumlah Data
                                                    <span class="badge bg-info" id="settingsDataCount">0</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Tanggal Backup Terakhir
                                                    <span class="badge bg-secondary" id="lastBackupDate">-</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Browser
                                                    <span class="badge bg-success" id="browserInfo">-</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Local Storage
                                                    <span class="badge bg-warning" id="storageInfo">-</span>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    Status
                                                    <span class="badge bg-success" id="appStatus">Aktif</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                &copy; 2025 BARJAS - Sistem Bantuan Terpadu. Hak Cipta Dilindungi.
            </div>
        </div>
        
        <div class="floating-action-btn" id="fabBtn">
            <i class="fas fa-plus"></i>
        </div>
        
        <div class="toast notification-toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
            <div class="toast-header">
                <i class="fas fa-bell text-primary me-2"></i>
                <strong class="me-auto">BARJAS Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                </div>
        </div>
    </div>
    
    <div class="modal fade" id="confirmResetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i> Konfirmasi Reset Data
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin mereset semua data?</p>
                    <p class="text-danger"><strong>Peringatan:</strong> Tindakan ini akan menghapus semua data dan tidak dapat dibatalkan!</p>
                    <p>Ketik <strong>RESET</strong> pada kolom di bawah untuk mengonfirmasi:</p>
                    <input type="text" class="form-control" id="resetConfirmationInput">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>Reset Data</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pratinjau Laporan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="preview-container" id="previewContent">
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="printFromPreviewBtn">
                        <i class="fas fa-print me-1"></i> Cetak
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade link-modal" id="driveLinkModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Link Google Drive</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="modalDriveLink" class="form-label">Link Google Drive</label>
                        <input type="url" class="form-control" id="modalDriveLink" placeholder="https://drive.google.com/...">
                    </div>
                    <div class="form-text">
                        Pastikan link dapat diakses secara publik atau melalui izin yang sesuai.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveDriveLinkBtn">Simpan</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.id.min.js"></script>
    
    <script>
        // Inisialisasi variabel global
        let appData = [];
        let appSettings = {
            securityCode: 'NKRI1945',
            itemsPerPage: 25,
            notifications: true,
            appName: 'BARJAS',
            appSubtitle: 'Sistem Bantuan Terpadu'
        };
        let currentPage = 1;
        let filteredData = [];
        let isFilterActive = false;
        let loginAttempts = 0;
        let isBlocked = false;
        let blockTimeout;
        let generatedCodes = {}; // Menyimpan kode yang sudah digenerate per NIK
        
        // Data desa dan kecamatan
        const kecamatanList = [
            "Arjasa", "Asembagus", "Banyuglugur", "Banyuputih", "Besuki", 
            "Bungatan", "Jangkar", "Jatibanteng", "Kapongan", "Kendit", 
            "Mangaran", "Mlandingan", "Panarukan", "Panji", "Situbondo", 
            "Suboh", "Sumbermalang"
        ];
        
        const desaList = [
            "Agel", "Alas Bayur", "Alasmalang", "Alastengah", "Arjasa", "Ardirejo", "Asembagus", 
            "Awar-awar", "Awang-awang", "Baderan", "Balung", "Bantal", "Battal", "Bayeman", "Besuki", "Bletok", "Blimbing", "Bloro", "Buduan", "Bugeman", "Bungatan", 
            "Campoan", "Cemara", "Curah Cottok", "Curah Jeru", "Curah Kalak", "Curah Suri", "Curah Tatal", "Dawuhan", "Demung", "Duwet", "Gadingan", "Gebangan", 
            "Gelung", "Gudang", "Gunung Malang", "Gunung Putri", "Jangkar", "Jatisari", "Jatibanteng", "Jetis", "Juglangan", "Kalianget", "Kalibagor", "Kalimas", 
            "Kalirejo", "Kalisari", "Kandang", "Kayu Putih", "Kayumas", "Kedungdowo", "Kedunglo", "Kembangsari", "Ketah", "Ketawan", "Kilensari", "Klampokan", 
            "Klatakan", "Kotakan", "Kumbangsari", "Kukusan", "Lamongan", "Landangan", "Langkap", "Lebeng", "Lubawang", "Mangaran", "Mimbaan", "Mlandingan Kulon", 
            "Mlandingan Wetan", "Mojodungkol", "Mojosari", "Olean", "Palangan", "Panarukan", "Panji Kidul", "Panji Lor", "Parante", "Pasir Putih", "Patemon", 
            "Patokan", "Paowan", "Peleyan", "Pesisir", "Pesanggrahan", "Pategalan", "Plalangan", "Pokaan", "Rajekwesi", "Seletreng", "Selobanteng", 
            "Selomukti", "Selowogo", "Semambung", "Semiring", "Sliwung", "Sopet", "Sumber Pinang", "Sumberanyar", "Sumberargo", "Sumberkolak", "Sumberejo", 
            "Sumbertengah", "Sumberwaru", "Tamankursi", "Tamansari", "Taman", "Talkandang", "Tanjung Glugur", "Tanjung Kamal", "Tanjung Pecinan", "Tambak Ukir", 
            "Telempong", "Tenggir", "Tepos", "Tokelan", "Tlogosari", "Trigonco", "Trebungan", "Widoropayung", "Wonokoyo", "Wonorejo", "Wringinanom"
        ].sort(); // Sort alphabetically for better user experience
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi aplikasi
            initializeApp();
            
            // Setup event listeners
            setupEventListeners();
            
            // Tampilkan modal login
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        });
        
        // Fungsi inisialisasi aplikasi
        function initializeApp() {
            // Muat data dan pengaturan
            loadSettings();
            loadData();

            // Isi dropdown tahun (2020-2090)
            fillYearDropdowns();
            
            // Isi dropdown kecamatan dan desa
            fillKecamatanDropdown();
            fillDesaDropdown();
            
            // Set tahun default ke tahun sekarang
            const currentYear = new Date().getFullYear();
            document.getElementById('tahunAnggaran').value = currentYear;
            
            // Set tanggal hari ini untuk input tanggal
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalTerima').value = today;
            
            // Inisialisasi chart
            initializeCharts();
            
            // Setup browser info
            setupBrowserInfo();

            // Render UI
            updateDashboard();
        }
        
        // Fungsi untuk mengisi dropdown tahun (2020-2090)
        function fillYearDropdowns() {
            const yearSelects = [
                'tahunAnggaran', 'filterTahun', 'printTahun', 
                'exportTahun', 'defaultTahun'
            ];
            
            const currentYear = new Date().getFullYear();

            for (const selectId of yearSelects) {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                
                if (selectId !== 'tahunAnggaran' && selectId !== 'defaultTahun') {
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Semua Tahun';
                    select.appendChild(defaultOption);
                }
                
                for (let year = 2020; year <= 2090; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    select.appendChild(option);
                }

                if (selectId === 'tahunAnggaran' || selectId === 'defaultTahun') {
                    select.value = currentYear;
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown kecamatan
        function fillKecamatanDropdown() {
            const kecamatanSelects = ['kecamatan', 'filterKecamatan', 'printKecamatan', 'exportKecamatan'];
            
            for (const selectId of kecamatanSelects) {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'kecamatan' ? 'Pilih Kecamatan' : 'Semua Kecamatan';
                select.appendChild(defaultOption);
                
                for (const kecamatan of kecamatanList) {
                    const option = document.createElement('option');
                    option.value = kecamatan;
                    option.textContent = kecamatan;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk mengisi dropdown desa
        function fillDesaDropdown() {
            const desaSelects = ['desa', 'filterDesa'];
            
            for (const selectId of desaSelects) {
                const select = document.getElementById(selectId);
                select.innerHTML = '';
                
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = selectId === 'desa' ? 'Pilih Desa' : 'Semua Desa';
                select.appendChild(defaultOption);
                
                for (const desa of desaList) {
                    const option = document.createElement('option');
                    option.value = desa;
                    option.textContent = desa;
                    select.appendChild(option);
                }
            }
        }
        
        // Fungsi untuk setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.querySelector('.toggle-password').addEventListener('click', togglePasswordVisibility);
            
            // Input form
            document.getElementById('inputForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('btnBukanKelompok').addEventListener('click', setBukanKelompok);
            document.getElementById('generateKodeBtn').addEventListener('click', generateKodeValidasi);
            
            // WhatsApp number formatting
            document.getElementById('whatsapp').addEventListener('input', formatWhatsAppNumber);
            
            // Data table
            document.getElementById('searchData').addEventListener('input', handleSearch);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            
            // Filter
            document.getElementById('applyFilterBtn').addEventListener('click', applyFilter);
            document.getElementById('resetFilterBtn').addEventListener('click', resetFilter);
            
            // Print & Export
            document.getElementById('printPdfBtn').addEventListener('click', printToPdf);
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCsv);
            document.getElementById('exportJsonBtn').addEventListener('click', exportToJson);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPdf);
            
            // Backup & Restore
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreFileInput').addEventListener('change', enableRestoreButton);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            document.getElementById('resetConfirmationInput').addEventListener('input', enableResetButton);
            document.getElementById('confirmResetBtn').addEventListener('click', resetData);
            
            // Settings
            document.getElementById('settingsForm').addEventListener('submit', handleSaveSettings);
            
            // Mobile menu
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleMobileMenu);
            
            // FAB button
            document.getElementById('fabBtn').addEventListener('click', () => document.getElementById('v-pills-input-tab').click());
            
            // Jenis bantuan change event
            document.getElementById('jenisBantuan').addEventListener('change', updateSatuanBantuan);

            // Print from preview button
            document.getElementById('printFromPreviewBtn').addEventListener('click', () => window.print());

            // Logout button
            document.getElementById('v-pills-logout-tab').addEventListener('click', logout);
        }
        
        // Fungsi untuk handle login
        function handleLogin(e) {
            e.preventDefault();
            
            if (isBlocked) {
                showNotification('Anda masih dalam masa pemblokiran. Silakan coba lagi nanti.', 'error');
                return;
            }
            
            const securityCodeInput = document.getElementById('securityCode').value;
            
            document.getElementById('loginSpinner').classList.remove('d-none');
            document.querySelector('.login-button-text').textContent = 'Memproses...';
            document.getElementById('loginButton').disabled = true;
            
            setTimeout(() => {
                document.getElementById('loginSpinner').classList.add('d-none');
                document.querySelector('.login-button-text').textContent = 'Masuk ke Aplikasi';
                document.getElementById('loginButton').disabled = false;

                if (securityCodeInput === appSettings.securityCode) {
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    if (loginModal) loginModal.hide();
                    
                    document.getElementById('appContent').style.display = 'block';
                    loginAttempts = 0;
                    updateAttemptsCount();
                    showNotification('Login berhasil! Selamat datang di aplikasi BARJAS.', 'success');
                } else {
                    loginAttempts++;
                    updateAttemptsCount();
                    
                    const loginForm = document.getElementById('loginForm');
                    loginForm.classList.add('login-shake');
                    setTimeout(() => loginForm.classList.remove('login-shake'), 600);
                    
                    if (loginAttempts >= 3) {
                        blockAccess();
                    }
                    
                    showNotification('Kode keamanan salah. Silakan coba lagi.', 'error');
                }
            }, 1000);
        }
        
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('securityCode');
            const toggleIcon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
        
        function updateAttemptsCount() {
            const attemptsElement = document.getElementById('attemptsCount');
            const blockedMessage = document.getElementById('blockedMessage');
            
            attemptsElement.style.display = loginAttempts > 0 ? 'block' : 'none';
            attemptsElement.textContent = `Percobaan login gagal: ${loginAttempts}/3`;
            
            blockedMessage.classList.toggle('d-none', !isBlocked);
        }
        
        function blockAccess() {
            isBlocked = true;
            updateAttemptsCount();
            
            let countdown = 30;
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = countdown;
            
            blockTimeout = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(blockTimeout);
                    isBlocked = false;
                    loginAttempts = 0;
                    updateAttemptsCount();
                }
            }, 1000);
        }
        
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar dari aplikasi?')) {
                document.getElementById('appContent').style.display = 'none';
                document.getElementById('securityCode').value = '';
                
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
                
                showNotification('Anda telah logout dari aplikasi.', 'info');
            }
        }
        
        function handleFormSubmit(e) {
            e.preventDefault();
            if (!validateForm()) return;
            
            const formData = {
                id: document.getElementById('inputForm').getAttribute('data-edit-id') ? parseInt(document.getElementById('inputForm').getAttribute('data-edit-id')) : Date.now(),
                nama: document.getElementById('nama').value.trim(),
                nik: document.getElementById('nik').value.trim(),
                whatsapp: document.getElementById('whatsapp').getAttribute('data-raw-value') || document.getElementById('whatsapp').value.replace(/\D/g, ''),
                namaKelompok: document.getElementById('namaKelompok').value.trim(),
                jabatan: document.getElementById('jabatan').value,
                tahunAnggaran: document.getElementById('tahunAnggaran').value,
                kecamatan: document.getElementById('kecamatan').value,
                desa: document.getElementById('desa').value,
                alamat: document.getElementById('alamat').value.trim(),
                jenisBantuan: document.getElementById('jenisBantuan').value,
                namaBantuan: document.getElementById('namaBantuan').value.trim(),
                jumlahBantuan: document.getElementById('jumlahBantuan').value,
                satuanBantuan: document.getElementById('satuanBantuan').value,
                tanggalTerima: document.getElementById('tanggalTerima').value,
                namaPetugas: document.getElementById('namaPetugas').value.trim(),
                driveLink: document.getElementById('driveLink').value.trim(),
                kodeValidasi: document.getElementById('kodeValidasi').value,
                keterangan: document.getElementById('keterangan').value.trim(),
                tanggalInput: new Date().toISOString()
            };
            
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            if (editId) {
                const index = appData.findIndex(item => item.id === parseInt(editId));
                if (index !== -1) {
                    formData.tanggalInput = appData[index].tanggalInput; // Keep original input date on edit
                    appData[index] = formData;
                    showNotification('Data berhasil diperbarui!', 'success');
                }
            } else {
                appData.push(formData);
                showNotification('Data berhasil disimpan!', 'success');
            }
            
            saveData();
            
            document.getElementById('inputForm').reset();
            document.getElementById('jabatan').value = 'Individu';
            document.getElementById('tahunAnggaran').value = new Date().getFullYear();
            document.getElementById('tanggalTerima').value = new Date().toISOString().split('T')[0];
            document.getElementById('kodeValidasi').value = '';
            document.getElementById('inputForm').removeAttribute('data-edit-id');
            
            updateDashboard();
            renderDataTable();
        }
        
        function validateForm() {
            let isValid = true;
            const fields = ['nama', 'nik', 'whatsapp', 'namaPetugas'];
            
            fields.forEach(fieldId => {
                const input = document.getElementById(fieldId);
                const errorEl = document.getElementById(`${fieldId}Error`);
                if (!input.value.trim()) {
                    if (errorEl) {
                        errorEl.textContent = `${input.previousElementSibling.textContent.trim()} harus diisi`;
                        errorEl.style.display = 'block';
                    }
                    input.classList.add('input-error');
                    isValid = false;
                } else {
                    if (errorEl) errorEl.style.display = 'none';
                    input.classList.remove('input-error');
                }
            });

            const nikInput = document.getElementById('nik');
            if (isNikExists(nikInput.value.trim())) {
                 document.getElementById('nikError').textContent = 'NIK sudah terdaftar dalam sistem';
                 document.getElementById('nikError').style.display = 'block';
                 nikInput.classList.add('input-error');
                 isValid = false;
            }

            if (!document.getElementById('kodeValidasi').value) {
                showNotification('Harap generate kode validasi terlebih dahulu', 'error');
                isValid = false;
            }
            
            return isValid;
        }
        
        function formatWhatsAppNumber(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('0')) value = value.substring(1);
            if (value.startsWith('62')) value = value.substring(2);

            e.target.setAttribute('data-raw-value', '62' + value);
            
            e.target.value = value.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
        }
        
        function isNikExists(nik) {
            const editId = document.getElementById('inputForm').getAttribute('data-edit-id');
            return appData.some(data => data.nik === nik && data.id !== (editId ? parseInt(editId) : null));
        }
        
        function setBukanKelompok() {
            document.getElementById('namaKelompok').value = 'BUKAN KELOMPOK';
            document.getElementById('jabatan').value = 'Individu';
        }
        
        function generateKodeValidasi() {
            const nik = document.getElementById('nik').value;
            if (!nik) {
                showNotification('Harap isi NIK terlebih dahulu', 'error');
                return;
            }
            
            if (generatedCodes[nik]) {
                document.getElementById('kodeValidasi').value = generatedCodes[nik];
                showNotification('Kode validasi sudah digenerate untuk NIK ini', 'info');
                return;
            }
            
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            generatedCodes[nik] = result;
            document.getElementById('kodeValidasi').value = result;
            saveData(); // Save the new code immediately
            
            showNotification('Kode validasi berhasil digenerate', 'success');
        }
        
        function updateSatuanBantuan() {
            const jenisBantuan = document.getElementById('jenisBantuan').value;
            const satuanBantuan = document.getElementById('satuanBantuan');
            
            satuanBantuan.innerHTML = '';
            let options = [];
            
            if (jenisBantuan === 'Uang') {
                options = ['Rupiah'];
            } else if (jenisBantuan === 'Barang') {
                options = ['Unit', 'Paket', 'Set', 'Buah', 'Ekor'];
            } else if (jenisBantuan === 'Jasa') {
                options = ['Jam', 'Hari', 'Paket', 'Kegiatan'];
            }

            options.forEach(opt => {
                satuanBantuan.innerHTML += `<option value="${opt}">${opt}</option>`;
            });
        }
        
        // --- DATA & SETTINGS MANAGEMENT ---
        function loadData() {
            const savedData = localStorage.getItem('barjasData');
            if (savedData) appData = JSON.parse(savedData);
            
            const savedCodes = localStorage.getItem('barjasGeneratedCodes');
            if (savedCodes) generatedCodes = JSON.parse(savedCodes);

            renderDataTable();
        }
        
        function saveData() {
            localStorage.setItem('barjasData', JSON.stringify(appData));
            localStorage.setItem('barjasGeneratedCodes', JSON.stringify(generatedCodes));
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('barjasSettings');
            if (savedSettings) {
                appSettings = JSON.parse(savedSettings);
            }
            // Apply settings to the UI
            document.getElementById('itemsPerPage').value = appSettings.itemsPerPage;
            document.getElementById('notifications').checked = appSettings.notifications;
            document.getElementById('appName').value = appSettings.appName;
            document.getElementById('appSubtitle').value = appSettings.appSubtitle;
            document.querySelector('.app-title').textContent = appSettings.appName;
            document.querySelector('.app-subtitle').textContent = appSettings.appSubtitle;
        }

        function saveSettings() {
            localStorage.setItem('barjasSettings', JSON.stringify(appSettings));
        }

        function handleSaveSettings(e) {
            e.preventDefault();
            const newSecurityCode = document.getElementById('settingSecurityCode').value;
            if (newSecurityCode) {
                appSettings.securityCode = newSecurityCode;
            }
            appSettings.itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
            appSettings.notifications = document.getElementById('notifications').checked;
            appSettings.appName = document.getElementById('appName').value;
            appSettings.appSubtitle = document.getElementById('appSubtitle').value;

            saveSettings();
            loadSettings(); // Re-apply settings
            showNotification('Pengaturan berhasil disimpan.', 'success');
            renderDataTable(); // Re-render table with new items per page setting
        }
        
        // --- DATA TABLE & PAGINATION ---
        function renderDataTable() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '';
            
            const dataToRender = isFilterActive ? filteredData : appData;
            const startIndex = (currentPage - 1) * appSettings.itemsPerPage;
            const endIndex = Math.min(startIndex + appSettings.itemsPerPage, dataToRender.length);
            
            if (dataToRender.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="17" class="text-center py-4">Tidak ada data</td></tr>`;
                document.getElementById('tableInfo').textContent = 'Menampilkan 0 dari 0 data';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            for (let i = startIndex; i < endIndex; i++) {
                const data = dataToRender[i];
                const row = document.createElement('tr');
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace(/^62/, '0') : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td><span class="whatsapp-number" data-phone="${data.whatsapp}">${whatsappDisplay}</span></td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>${data.driveLink ? `<a href="${data.driveLink}" class="drive-link" target="_blank"><i class="fas fa-external-link-alt"></i> Buka</a>` : '-'}</td>
                    <td>${data.kodeValidasi}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-primary" onclick="editData(${data.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-danger" onclick="deleteData(${data.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            }
            
            document.getElementById('tableInfo').textContent = `Menampilkan ${startIndex + 1} sampai ${endIndex} dari ${dataToRender.length} data`;
            updatePagination(dataToRender.length);
            
            document.querySelectorAll('.whatsapp-number').forEach(el => {
                el.addEventListener('click', function() {
                    const phone = this.getAttribute('data-phone');
                    if (phone) window.open(`https://wa.me/${phone}`, '_blank');
                });
            });
        }
        
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / appSettings.itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;"><i class="fas fa-chevron-left"></i></a>`;
            paginationElement.appendChild(prevLi);
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>`;
                paginationElement.appendChild(pageLi);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;"><i class="fas fa-chevron-right"></i></a>`;
            paginationElement.appendChild(nextLi);
        }
        
        function changePage(page) {
            const dataToRender = isFilterActive ? filteredData : appData;
            const totalPages = Math.ceil(dataToRender.length / appSettings.itemsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderDataTable();
        }
        
        // --- SEARCH & FILTER ---
        function handleSearch() {
            const searchTerm = document.getElementById('searchData').value.toLowerCase();
            isFilterActive = !!searchTerm;
            
            if (isFilterActive) {
                filteredData = appData.filter(data => 
                    Object.values(data).some(value => 
                        String(value).toLowerCase().includes(searchTerm)
                    )
                );
            }
            
            currentPage = 1;
            renderDataTable();
        }
        
        function clearSearch() {
            document.getElementById('searchData').value = '';
            isFilterActive = false;
            currentPage = 1;
            renderDataTable();
        }
        
        function applyFilter() {
            const tahun = document.getElementById('filterTahun').value;
            const kecamatan = document.getElementById('filterKecamatan').value;
            const desa = document.getElementById('filterDesa').value;
            const jenis = document.getElementById('filterJenis').value;
            
            filteredData = appData.filter(data => 
                (!tahun || data.tahunAnggaran == tahun) &&
                (!kecamatan || data.kecamatan === kecamatan) &&
                (!desa || data.desa === desa) &&
                (!jenis || data.jenisBantuan === jenis)
            );
            
            isFilterActive = true;
            renderFilterTable();
            document.getElementById('filterResultCount').textContent = `${filteredData.length} Data`;
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }
        
        function resetFilter() {
            document.getElementById('filterTahun').value = '';
            document.getElementById('filterKecamatan').value = '';
            document.getElementById('filterDesa').value = '';
            document.getElementById('filterJenis').value = '';
            
            isFilterActive = false;
            filteredData = [];
            renderFilterTable(); // Will show empty state
            document.getElementById('filterResultCount').textContent = '0 Data';
            showNotification('Filter direset.', 'info');
        }
        
        function renderFilterTable() {
            const tableBody = document.getElementById('filterTableBody');
            tableBody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="16" class="text-center py-4">Tidak ada data yang sesuai dengan filter</td></tr>`;
                return;
            }
            
            filteredData.forEach((data, i) => {
                const row = document.createElement('tr');
                const whatsappDisplay = data.whatsapp ? data.whatsapp.replace(/^62/, '0') : '-';
                
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${data.nama}</td>
                    <td>${data.nik}</td>
                    <td><span class="whatsapp-number" data-phone="${data.whatsapp}">${whatsappDisplay}</span></td>
                    <td>${data.namaKelompok || '-'}</td>
                    <td>${data.jabatan || '-'}</td>
                    <td>${data.tahunAnggaran}</td>
                    <td>${data.kecamatan}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.namaBantuan || '-'}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                    <td>${formatDate(data.tanggalTerima)}</td>
                    <td>${data.namaPetugas || '-'}</td>
                    <td>${data.driveLink ? `<a href="${data.driveLink}" class="drive-link" target="_blank"><i class="fas fa-external-link-alt"></i> Buka</a>` : '-'}</td>
                    <td>${data.kodeValidasi}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // --- CRUD ACTIONS ---
        function editData(id) {
            const data = appData.find(item => item.id === id);
            if (!data) return;
            
            Object.keys(data).forEach(key => {
                const el = document.getElementById(key);
                if (el) el.value = data[key];
            });
            
            document.getElementById('inputForm').setAttribute('data-edit-id', id);
            document.getElementById('v-pills-input-tab').click();
            window.scrollTo(0, 0);
            showNotification('Data siap untuk diedit. Klik "Simpan Data" setelah melakukan perubahan.', 'info');
        }
        
        function deleteData(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                appData = appData.filter(item => item.id !== id);
                saveData();
                showNotification('Data berhasil dihapus.', 'success');
                updateDashboard();
                renderDataTable();
            }
        }
        
        // --- DASHBOARD & CHARTS ---
        function updateDashboard() {
            document.getElementById('totalPenerima').textContent = appData.length;
            
            const totalBantuan = appData.reduce((sum, data) => sum + (data.jenisBantuan === 'Uang' ? parseFloat(data.jumlahBantuan.replace(/\D/g,'')) || 0 : 0), 0);
            document.getElementById('totalBantuan').textContent = `Rp ${formatNumber(totalBantuan)}`;
            
            const tahunCount = appData.reduce((acc, data) => {
                acc[data.tahunAnggaran] = (acc[data.tahunAnggaran] || 0) + 1;
                return acc;
            }, {});
            const tahunAktif = Object.keys(tahunCount).reduce((a, b) => tahunCount[a] > tahunCount[b] ? a : b, new Date().getFullYear());
            document.getElementById('tahunAktif').textContent = tahunAktif;
            
            const rataBantuan = appData.length > 0 ? totalBantuan / appData.length : 0;
            document.getElementById('rataBantuan').textContent = `Rp ${formatNumber(rataBantuan.toFixed(0))}`;
            
            updateCharts();
            updateRecentData();
            document.getElementById('settingsDataCount').textContent = appData.length;
        }
        
        function updateRecentData() {
            const recentDataContainer = document.getElementById('recentData');
            recentDataContainer.innerHTML = '';
            
            const recentData = [...appData].sort((a, b) => new Date(b.tanggalInput) - new Date(a.tanggalInput)).slice(0, 5);
            
            if (recentData.length === 0) {
                recentDataContainer.innerHTML = `<tr><td colspan="5" class="text-center">Tidak ada data</td></tr>`;
                return;
            }
            
            recentData.forEach(data => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(data.tanggalInput)}</td>
                    <td>${data.nama}</td>
                    <td>${data.desa}</td>
                    <td>${data.jenisBantuan}</td>
                    <td>${data.jumlahBantuan} ${data.satuanBantuan}</td>
                `;
                recentDataContainer.appendChild(row);
            });
        }
        
        function initializeCharts() {
            Chart.defaults.font.family = "'Poppins', 'Segoe UI', sans-serif";
            const pieCtx = document.getElementById('kecamatanChart');
            if (pieCtx) {
                window.kecamatanChart = new Chart(pieCtx, { type: 'pie', options: { responsive: true, plugins: { legend: { position: 'right' } } } });
            }
            
            const barCtx = document.getElementById('tahunChart');
            if (barCtx) {
                window.tahunChart = new Chart(barCtx, { type: 'bar', options: { responsive: true, scales: { y: { beginAtZero: true } } } });
            }
        }
        
        function updateCharts() {
            const kecamatanData = appData.reduce((acc, data) => {
                acc[data.kecamatan] = (acc[data.kecamatan] || 0) + 1;
                return acc;
            }, {});
            if (window.kecamatanChart) {
                window.kecamatanChart.data = {
                    labels: Object.keys(kecamatanData),
                    datasets: [{ data: Object.values(kecamatanData), backgroundColor: ['#0d47a1', '#1565c0', '#1976d2', '#1e88e5', '#2196f3', '#42a5f5', '#64b5f6', '#90caf9', '#bbdefb', '#e3f2fd'] }]
                };
                window.kecamatanChart.update();
            }
            
            const tahunData = appData.reduce((acc, data) => {
                acc[data.tahunAnggaran] = (acc[data.tahunAnggaran] || 0) + 1;
                return acc;
            }, {});
            const sortedYears = Object.keys(tahunData).sort();
            if (window.tahunChart) {
                window.tahunChart.data = {
                    labels: sortedYears,
                    datasets: [{ label: 'Jumlah Penerima', data: sortedYears.map(year => tahunData[year]), backgroundColor: '#00695c' }]
                };
                window.tahunChart.update();
            }
        }
        
        // --- PRINT & EXPORT ---
        function printToPdf() {
            if (appData.length === 0) return showNotification('Tidak ada data untuk dicetak.', 'warning');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'pt', 'a4');
            
            doc.setFontSize(18);
            doc.text('LAPORAN DATA BANTUAN', doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
            
            const tableColumn = ["No", "Nama", "NIK", "Desa", "Jenis", "Nama Bantuan", "Jumlah", "Tanggal"];
            const tableRows = (isFilterActive ? filteredData : appData).map((data, index) => [
                index + 1, data.nama, data.nik, data.desa, data.jenisBantuan, data.namaBantuan || '-',
                `${data.jumlahBantuan} ${data.satuanBantuan}`, formatDate(data.tanggalTerima)
            ]);
            
            doc.autoTable({ head: [tableColumn], body: tableRows, startY: 60, theme: 'grid', headStyles: { fillColor: [13, 71, 161] } });
            doc.save(`laporan_bantuan_${new Date().toISOString().slice(0,10)}.pdf`);
            showNotification('Laporan PDF telah berhasil diunduh.', 'success');
        }
        
        function showPreview() {
            const dataToPrint = appData; // Simplified to preview all data
            if (dataToPrint.length === 0) return showNotification('Tidak ada data untuk dipratinjau.', 'warning');

            let previewContent = `
                <div class="print-header">
                    <h4 class="print-title">LAPORAN DATA BANTUAN</h4>
                    <p class="print-subtitle">Sistem Bantuan Terpadu (BARJAS) - Kabupaten Situbondo</p>
                    <p class="print-date">Tanggal Cetak: ${formatDate(new Date().toISOString())}</p>
                </div>
                <table class="preview-table"><thead><tr>
                    <th>No</th><th>Nama</th><th>NIK</th><th>Desa</th><th>Jenis Bantuan</th><th>Jumlah</th><th>Tanggal Terima</th>
                </tr></thead><tbody>`;

            dataToPrint.forEach((data, index) => {
                previewContent += `<tr>
                    <td>${index + 1}</td><td>${data.nama}</td><td>${data.nik}</td><td>${data.desa}</td>
                    <td>${data.namaBantuan}</td><td>${data.jumlahBantuan} ${data.satuanBantuan}</td><td>${formatDate(data.tanggalTerima)}</td>
                </tr>`;
            });

            previewContent += `</tbody></table><p class="mt-3">Total Data: ${dataToPrint.length}</p>`;
            document.getElementById('previewContent').innerHTML = previewContent;
            new bootstrap.Modal(document.getElementById('previewModal')).show();
        }
        
        function exportToExcel() {
            if (appData.length === 0) return showNotification('Tidak ada data untuk diekspor.', 'warning');
            const dataToExport = isFilterActive ? filteredData : appData;
            const worksheet = XLSX.utils.json_to_sheet(dataToExport);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Data Bantuan');
            XLSX.writeFile(workbook, 'data_bantuan.xlsx');
            showNotification('Data telah berhasil diekspor ke Excel.', 'success');
        }
        
        function exportToCsv() {
             if (appData.length === 0) return showNotification('Tidak ada data untuk diekspor.', 'warning');
            const dataToExport = isFilterActive ? filteredData : appData;
            const worksheet = XLSX.utils.json_to_sheet(dataToExport);
            const csv = XLSX.utils.sheet_to_csv(worksheet);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.setAttribute('download', 'data_bantuan.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Data telah berhasil diekspor ke CSV.', 'success');
        }
        
        function exportToJson() {
            if (appData.length === 0) return showNotification('Tidak ada data untuk diekspor.', 'warning');
            const dataToExport = isFilterActive ? filteredData : appData;
            const json = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.setAttribute('download', 'data_bantuan.json');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Data telah berhasil diekspor ke JSON.', 'success');
        }
        
        function exportToPdf() {
            printToPdf();
        }
        
        // --- BACKUP & RESTORE ---
        function backupData() {
            if (appData.length === 0) return showNotification('Tidak ada data untuk dibackup.', 'warning');
            
            const backupFileName = document.getElementById('backupFileName').value || 'backup-barjas-secure';
            // Encode to Base64 for obfuscation
            const dataStr = btoa(unescape(encodeURIComponent(JSON.stringify(appData))));
            
            const linkElement = document.createElement('a');
            linkElement.href = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            linkElement.download = `${backupFileName}-${new Date().toISOString().slice(0,10)}.json`;
            linkElement.click();
            
            document.getElementById('lastBackupDate').textContent = new Date().toLocaleDateString('id-ID');
            showNotification('Backup data terenkripsi berhasil didownload.', 'success');
        }
        
        function enableRestoreButton() {
            document.getElementById('restoreDataBtn').disabled = !this.files.length;
        }
        
        function restoreData() {
            const file = document.getElementById('restoreFileInput').files[0];
            if (!file || !confirm('Restore data akan menimpa semua data yang ada. Lanjutkan?')) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let restoredData;
                    const content = e.target.result;
                    try {
                        // First, try to decode from Base64 (new format)
                        restoredData = JSON.parse(decodeURIComponent(escape(atob(content))));
                    } catch (error) {
                        // If it fails, assume it's the old, plain JSON format
                        restoredData = JSON.parse(content);
                    }

                    if (Array.isArray(restoredData)) {
                        appData = restoredData;
                        saveData();
                        document.getElementById('restoreFileInput').value = '';
                        document.getElementById('restoreDataBtn').disabled = true;
                        updateDashboard();
                        renderDataTable();
                        showNotification('Data berhasil direstore.', 'success');
                    } else {
                        throw new Error("Invalid data format.");
                    }
                } catch (error) {
                    showNotification('File backup tidak valid atau rusak.', 'error');
                    console.error('Restore error:', error);
                }
            };
            reader.readAsText(file);
        }
        
        function enableResetButton() {
            document.getElementById('confirmResetBtn').disabled = this.value !== 'RESET';
        }
        
        function resetData() {
            appData = [];
            generatedCodes = {};
            saveData();
            bootstrap.Modal.getInstance(document.getElementById('confirmResetModal')).hide();
            document.getElementById('resetConfirmationInput').value = '';
            updateDashboard();
            renderDataTable();
            showNotification('Semua data telah direset.', 'success');
        }

        // --- UTILITY FUNCTIONS ---
        function setupBrowserInfo() {
            document.getElementById('browserInfo').textContent = navigator.userAgentData?.brands[0]?.brand || 'Unknown';
            const usedStorage = (JSON.stringify(localStorage).length / 1024).toFixed(2);
            document.getElementById('storageInfo').textContent = `${usedStorage} KB`;
        }
        
        function toggleMobileMenu() {
            document.getElementById('sidebarMenu').classList.toggle('mobile-show');
            document.getElementById('sidebarOverlay').classList.toggle('mobile-show');
        }
        
        function showNotification(message, type = 'info') {
            if (!appSettings.notifications) return;

            const toastEl = document.querySelector('.notification-toast');
            const toastHeader = toastEl.querySelector('.toast-header');
            document.getElementById('toastMessage').textContent = message;
            
            const colors = {
                success: { bg: '#d4edda', text: '#155724' },
                error: { bg: '#f8d7da', text: '#721c24' },
                warning: { bg: '#fff3cd', text: '#856404' },
                info: { bg: '#d1ecf1', text: '#0c5460' }
            };
            
            toastHeader.style.backgroundColor = colors[type].bg;
            toastHeader.style.color = colors[type].text;
            
            new bootstrap.Toast(toastEl).show();
        }
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }
    </script>
</body>
</html>
